var RESULT={HIT:0,MISS:1,DODGE:2,CRIT:3,GLANCE:4},step=0,log=!1,version=2;class Simulation{constructor(e,s,t){this.player=e,this.timesecsmin=parseInt($('input[name="timesecsmin"]').val()),this.timesecsmax=parseInt($('input[name="timesecsmax"]').val()),this.executeperc=parseInt($('input[name="executeperc"]').val()),this.startrage=parseInt($('input[name="startrage"]').val()),this.iterations=parseInt($('input[name="simulations"]').val()),this.idmg=0,this.totaldmg=0,this.totalduration=0,this.mindps=99999,this.maxdps=0,this.maxcallstack=Math.min(Math.floor(this.iterations/10),1e3),this.starttime=0,this.endtime=0,this.cb_update=t,this.cb_finished=s,this.spread=[],this.bloodfurystep=1e3*parseInt(spells[11].time),this.berserkingstep=1e3*parseInt(spells[10].time),this.reckstep=1e3*parseInt(spells[7].time),this.priorityap=parseInt(spells[4].priorityap),log=1==this.iterations}start(){this.run(1),this.starttime=(new Date).getTime()}run(e){step=0,this.idmg=0;let s,t,a=this.player;a.reset(this.startrage),this.maxsteps=rng(1e3*this.timesecsmin,1e3*this.timesecsmax),this.duration=this.maxsteps/1e3,this.executestep=this.maxsteps-parseInt(this.maxsteps*(this.executeperc/100)),this.fifteenstep=Math.max(this.maxsteps-16e3,0),this.twentystep=Math.max(this.maxsteps-21e3,0),this.thirtystep=Math.max(this.maxsteps-31e3,0),this.sixtystep=Math.max(this.maxsteps-61e3,0);let l=!1,r=0;for(;step<this.maxsteps;)if(0!=r&&step%3e3==0&&a.talents.angermanagement&&(a.rage=a.rage>=99?100:a.rage+1,l=!0),a.vaelbuff&&0!=r&&step%1e3==0&&(a.rage=a.rage>=80?100:a.rage+20,l=!0),a.mh.timer<=0&&(this.idmg+=a.attackmh(a.mh),l=!0),a.oh&&a.oh.timer<=0&&(this.idmg+=a.attackoh(a.oh),l=!0),l&&!a.spelldelay&&(a.spells.bloodrage&&a.spells.bloodrage.canUse()?(a.spelldelay=1,s=a.spells.bloodrage):a.auras.mightyragepotion&&a.auras.mightyragepotion.canUse()?(a.spelldelay=1,s=a.auras.mightyragepotion):a.timer||(a.auras.flask&&a.auras.flask.canUse()&&step>this.sixtystep?(a.spelldelay=1,s=a.auras.flask):a.auras.cloudkeeper&&a.auras.cloudkeeper.canUse()&&step>this.thirtystep?(a.spelldelay=1,s=a.auras.cloudkeeper):a.auras.recklessness&&a.auras.recklessness.canUse()&&step>this.reckstep?(a.spelldelay=1,s=a.auras.recklessness):a.auras.deathwish&&a.auras.deathwish.canUse()?(a.spelldelay=1,s=a.auras.deathwish):a.auras.bloodfury&&a.auras.bloodfury.canUse()&&step>this.bloodfurystep?(a.spelldelay=1,s=a.auras.bloodfury):a.auras.berserking&&a.auras.berserking.canUse()&&step>this.berserkingstep?(a.spelldelay=1,s=a.auras.berserking):a.auras.slayer&&a.auras.slayer.canUse()&&step>this.twentystep?(a.spelldelay=1,s=a.auras.slayer):a.auras.spider&&a.auras.spider.canUse()&&step>this.fifteenstep?(a.spelldelay=1,s=a.auras.spider):a.auras.gabbar&&a.auras.gabbar.canUse()&&step>this.twentystep?(a.spelldelay=1,s=a.auras.gabbar):a.auras.earthstrike&&a.auras.earthstrike.canUse()&&step>this.twentystep?(a.spelldelay=1,s=a.auras.earthstrike):a.auras.pummeler&&a.auras.pummeler.canUse()&&step>this.thirtystep?(a.spelldelay=1,s=a.auras.pummeler):a.auras.swarmguard&&a.auras.swarmguard.canUse()&&step>this.thirtystep?(a.spelldelay=1,s=a.auras.swarmguard):a.auras.zandalarian&&a.auras.zandalarian.canUse()&&step>this.twentystep?(a.spelldelay=1,s=a.auras.zandalarian):a.spells.execute&&step>=this.executestep?a.spells.bloodthirst&&a.stats.ap>=this.priorityap&&a.spells.bloodthirst.canUse()?(a.spelldelay=1,s=a.spells.bloodthirst):a.spells.mortalstrike&&a.stats.ap>=this.priorityap&&a.spells.mortalstrike.canUse()?(a.spelldelay=1,s=a.spells.mortalstrike):a.spells.execute.canUse()&&(a.spelldelay=1,s=a.spells.execute):a.spells.sunderarmor&&a.spells.sunderarmor.canUse()?(a.spelldelay=1,s=a.spells.sunderarmor):a.spells.bloodthirst&&a.spells.bloodthirst.canUse()?(a.spelldelay=1,s=a.spells.bloodthirst):a.spells.mortalstrike&&a.spells.mortalstrike.canUse()?(a.spelldelay=1,s=a.spells.mortalstrike):a.spells.whirlwind&&a.spells.whirlwind.canUse()?(a.spelldelay=1,s=a.spells.whirlwind):a.spells.overpower&&a.spells.overpower.canUse()?(a.spelldelay=1,s=a.spells.overpower):a.spells.hamstring&&a.spells.hamstring.canUse()&&(a.spelldelay=1,s=a.spells.hamstring)),a.heroicdelay&&(l=!1)),l&&!a.heroicdelay&&(!a.spells.execute||step<this.executestep?a.spells.heroicstrike&&a.spells.heroicstrike.canUse()&&(a.heroicdelay=1,t=a.spells.heroicstrike):a.spells.heroicstrikeexecute&&a.spells.heroicstrikeexecute.canUse()&&(a.heroicdelay=1,t=a.spells.heroicstrikeexecute),l=!1),a.spelldelay&&s&&a.spelldelay>s.maxdelay&&(a.heroicdelay&&t&&a.heroicdelay>t.maxdelay&&(a.heroicdelay=t.maxdelay-49),s.canUse()?(this.idmg+=a.cast(s),a.spelldelay=0,l=!0):a.spelldelay=0),a.heroicdelay&&t&&a.heroicdelay>t.maxdelay&&(t.canUse()?(a.cast(t),a.heroicdelay=0,l=!0):a.heroicdelay=0),a.spells.heroicstrike&&a.spells.heroicstrike.unqueue&&a.nextswinghs&&a.rage<a.spells.heroicstrike.unqueue&&a.mh.timer<=a.spells.heroicstrike.unqueuetimer&&(this.player.nextswinghs=!1),a.extraattacks>0&&(a.mh.timer=0,a.extraattacks--),a.batchedextras>0&&(a.mh.timer=400-step%400,a.batchedextras--),!a.mh.timer||!a.spelldelay&&l||!a.heroicdelay&&l)r=0;else{if(r=Math.min(a.mh.timer,a.oh?a.oh.timer:9999),a.spelldelay&&s.maxdelay-a.spelldelay<r&&(r=s.maxdelay-a.spelldelay+1),a.heroicdelay&&t.maxdelay-a.heroicdelay<r&&(r=t.maxdelay-a.heroicdelay+1),a.timer&&a.timer<r&&(r=a.timer),a.itemtimer&&a.itemtimer<r&&(r=a.itemtimer),a.talents.angermanagement&&3e3-step%3e3<r&&(r=3e3-step%3e3),a.vaelbuff&&1e3-step%1e3<r&&(r=1e3-step%1e3),a.auras.bloodrage&&a.auras.bloodrage.timer&&1e3-(step-a.auras.bloodrage.starttimer)%1e3<r&&(r=1e3-(step-a.auras.bloodrage.starttimer)%1e3),a.auras.gabbar&&a.auras.gabbar.timer&&2e3-(step-a.auras.gabbar.starttimer)%2e3<r&&(r=2e3-(step-a.auras.gabbar.starttimer)%2e3),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&a.spells.bloodthirst.timer<r&&(r=a.spells.bloodthirst.timer),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&a.spells.mortalstrike.timer<r&&(r=a.spells.mortalstrike.timer),a.spells.whirlwind&&a.spells.whirlwind.timer&&a.spells.whirlwind.timer<r&&(r=a.spells.whirlwind.timer),a.spells.bloodrage&&a.spells.bloodrage.timer&&a.spells.bloodrage.timer<r&&(r=a.spells.bloodrage.timer),a.spells.overpower&&a.spells.overpower.timer&&a.spells.overpower.timer<r&&(r=a.spells.overpower.timer),a.spells.execute&&a.spells.execute.timer&&a.spells.execute.timer<r&&(r=a.spells.execute.timer),a.spells.heroicstrike&&a.spells.heroicstrike.unqueue){let e=Math.max(a.mh.timer-a.spells.heroicstrike.unqueuetimer);e>0&&e<r&&(r=e)}step+=r,a.mh.step(r),a.oh&&a.oh.step(r),a.timer&&a.steptimer(r)&&!a.spelldelay&&(l=!0),a.itemtimer&&a.stepitemtimer(r)&&!a.spelldelay&&(l=!0),a.dodgetimer&&a.stepdodgetimer(r),a.spelldelay&&(a.spelldelay+=r),a.heroicdelay&&(a.heroicdelay+=r),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&!a.spells.bloodthirst.step(r)&&!a.spelldelay&&(l=!0),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&!a.spells.mortalstrike.step(r)&&!a.spelldelay&&(l=!0),a.spells.whirlwind&&a.spells.whirlwind.timer&&!a.spells.whirlwind.step(r)&&!a.spelldelay&&(l=!0),a.spells.bloodrage&&a.spells.bloodrage.timer&&!a.spells.bloodrage.step(r)&&!a.spelldelay&&(l=!0),a.spells.overpower&&a.spells.overpower.timer&&!a.spells.overpower.step(r)&&!a.spelldelay&&(l=!0),a.spells.execute&&a.spells.execute.timer&&!a.spells.execute.step(r)&&!a.spelldelay&&(l=!0),a.auras.bloodrage&&a.auras.bloodrage.timer&&!a.auras.bloodrage.step()&&!a.spelldelay&&(l=!0),a.auras.gabbar&&a.auras.gabbar.timer&&a.auras.gabbar.step()}a.endauras(),this.totaldmg+=this.idmg,this.totalduration+=this.duration;let i=this.idmg/this.duration;if(i<this.mindps&&(this.mindps=i),i>this.maxdps&&(this.maxdps=i),i=Math.round(i),this.spread[i]?this.spread[i]++:this.spread[i]=1,e==this.iterations)this.endtime=(new Date).getTime(),this.cb_finished&&this.cb_finished();else if(e%this.maxcallstack==0){let s=this;this.cb_update&&this.cb_update(e),setTimeout(function(){s.run(e+1)},0)}else this.run(e+1)}}function rng(e,s){return~~(Math.random()*(s-e+1)+e)}function rng10k(){return~~(1e4*Math.random())}function avg(e,s){return(e+s)/2}